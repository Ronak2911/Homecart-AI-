{% extends 'base/base.html' %}
{% block title %}Dashboard{% endblock %}

{% block body %}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fw-bold text-dark mb-0">Dashboard</h3>
    </div>

    {% if data.role == "admin" %}

    <!-- ================= ADMIN KPI CARDS ================= -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card p-3 shadow-sm border-0 border-start border-4 border-primary rounded-4">
                <h6 class="text-muted text-uppercase small fw-bold">Total Properties</h6>
                <h2 class="mb-0 text-primary">{{ data.stats.properties }}</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 shadow-sm border-0 border-start border-4 border-success rounded-4">
                <h6 class="text-muted text-uppercase small fw-bold">Total Customers</h6>
                <h2 class="mb-0 text-success">{{ data.stats.customers }}</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 shadow-sm border-0 border-start border-4 border-warning rounded-4">
                <h6 class="text-muted text-uppercase small fw-bold">Total Inquiries</h6>
                <h2 class="mb-0 text-warning">{{ data.stats.inquiries }}</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 shadow-sm border-0 border-start border-4 border-info rounded-4">
                <h6 class="text-muted text-uppercase small fw-bold">Total Visits</h6>
                <h2 class="mb-0 text-info">{{ data.stats.visits }}</h2>
            </div>
        </div>
    </div>

    <!-- ================= ADMIN BAR CHART ================= -->
    <div class="card shadow-sm border-0 p-4 mb-4">
        <h5 class="fw-bold text-dark mb-3">Overall System Overview</h5>
        <div style="height: 350px;">
            <canvas id="adminBarChart"></canvas>
        </div>
    </div>

    {% else %}

    <!-- ================= STAFF KPI CARDS ================= -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card p-3 shadow-sm border-0 border-start border-4 border-primary rounded-4">
                <h6 class="text-muted text-uppercase small fw-bold">My Visits</h6>
                <h2 class="mb-0 text-primary">{{ data.stats.total }}</h2>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card p-3 shadow-sm border-0 border-start border-4 border-warning rounded-4">
                <h6 class="text-muted text-uppercase small fw-bold">Upcoming</h6>
                <h2 class="mb-0 text-warning">{{ data.stats.upcoming }}</h2>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card p-3 shadow-sm border-0 border-start border-4 border-success rounded-4">
                <h6 class="text-muted text-uppercase small fw-bold">Completed</h6>
                <h2 class="mb-0 text-success">{{ data.stats.completed }}</h2>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card p-3 shadow-sm border-0 border-start border-4 border-info rounded-4">
                <h6 class="text-muted text-uppercase small fw-bold">Performance %</h6>
                <h2 class="mb-0 text-info">
                    {% if data.stats.total > 0 %}
                        {{ ((data.stats.completed / data.stats.total) * 100) | round(1) }}%
                    {% else %}
                        0%
                    {% endif %}
                </h2>
            </div>
        </div>
    </div>

    <!-- ================= STAFF BAR CHART ================= -->
    <div class="card shadow-sm border-0 p-4 mb-4">
        <h5 class="fw-bold text-dark mb-3">My Visit Overview</h5>
        <div style="height: 350px;">
            <canvas id="staffBarChart"></canvas>
        </div>
    </div>

    {% endif %}
</div>

<!-- ================= CHART JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% if data.role == "admin" %}
<script>

new Chart(document.getElementById('adminBarChart'), {
    type: 'bar',
    data: {
        labels: ['Properties', 'Customers', 'Inquiries', 'Visits'],
        datasets: [{
            data: [
                {{ data.stats.properties }},
                {{ data.stats.customers }},
                {{ data.stats.inquiries }},
                {{ data.stats.visits }}
            ],
            backgroundColor: ['#3498db','#2ecc71','#f39c12','#9b59b6'],
            borderRadius: 8,
            barThickness: 60
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});

</script>

{% else %}
<script>

new Chart(document.getElementById('staffBarChart'), {
    type: 'bar',
    data: {
        labels: ['My Visits', 'Upcoming', 'Completed'],
        datasets: [{
            data: [
                {{ data.stats.total }},
                {{ data.stats.upcoming }},
                {{ data.stats.completed }}
            ],
            backgroundColor: ['#3498db','#f39c12','#2ecc71'],
            borderRadius: 8,
            barThickness: 60
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});

</script>
{% endif %}

{% endblock %}